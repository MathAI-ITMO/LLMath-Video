# Web Video Player + LLM Prototype (.rm)

## 1) Описание проекта
Минимальный, расширяемый веб‑прототип видеоплеера:
- **Стек:** Python (Flask) для роутинга/отдачи статики + чистые JS/CSS/HTML для клиентской логики и UI.
- **Композиция экрана:**
  - Основная область видео с фиксируемым аспектом **16:9**.
  - Правый **sidebar** (ширина ~25%) — зарезервировано под будущий чат с LLM (сейчас пустой блок).
  - **Панель под видео** (слегка желтоватый фон): центрированный список ранее загруженных видео и **drop‑zone** для перетаскивания новых.
- **Поток работы:**
  - Выбор файла из списка или загрузка нового через drag‑and‑drop → видео сразу открывается в окне 16:9.
  - Под окном отображаются базовые контролы: play/pause, таймлайн/позиция, громкость, скорость.
- **Хранилище:** загруженные файлы сохраняются в `webapp/data/video`. Доступ к файлам организован эндпоинтом `/media/<filename>`.
- **Цель:** чистая архитектура, минимум зависимостей, готово к наращиванию функционала (позже: аннотации, таймкоды, подсказки LLM и т.п.).

---

## 2) Что уже сделано (как устроен прототип)
**Структура каталогов**
```
webapp/
  app.py                 # Flask‑приложение и API
  templates/
    index.html           # Разметка страницы (видео 16:9 + sidebar + нижняя панель)
  static/
    css/
      styles.css         # Светлая тема, адаптивный layout, акцентная панель под видео
    js/
      script.js          # Логика UI: список видео, загрузка, плеер‑контролы
  data/
    video/               # Сюда падают загруженные видеофайлы
```

**Ключевые эндпоинты**
- `GET /` — отрисовка главной страницы.
- `GET /videos` — JSON‑список файлов, отсортированный по дате изменения (для панели выбора).
- `POST /upload` — приём `multipart/form-data` с полем `file`, сохранение в `data/video/`, возврат статуса.
- `GET /media/<filename>` — отдача загруженного файла из хранилища.

**Фронт (минимум, но удобно)**
- Отрисовка списка доступных видео, клик по элементу — мгновенное воспроизведение в окне 16:9.
- Drag‑and‑drop: подсветка drop‑зоны, загрузка, автообновление списка.
- Контролы плеера: play/pause, прогресс‑бар (позиция), громкость, выбор скорости.

**Стиль/UX**
- Светлая, спокойная палитра; контрастные интерактивные элементы.
- Макет устойчив к ресайзу, sidebar фиксирован в ~25% ширины.

---

## 3) Как запускать
> Виртуальное окружение **уже создано** — его нужно лишь **активировать**. Далее установить зависимости и запустить сервер.

### Быстрый старт
1. **Активируйте окружение** (примерно так, подставьте своё имя папки окружения — чаще `.venv` или `venv`):
   - **Windows (PowerShell):**
     ```powershell
     .\.venv\Scripts\Activate.ps1
     ```
   - **Windows (cmd):**
     ```cmd
     .\.venv\Scripts\activate.bat
     ```
   - **macOS/Linux (bash/zsh):**
     ```bash
     source .venv/bin/activate
     ```

2. **Установите зависимости** (зависимость ровно одна, для простоты):
   ```bash
   pip install Flask
   ```
   > Если у вас есть `requirements.txt`, можно так:
   > ```bash
   > pip install -r requirements.txt
   > ```

3. **Запустите приложение**:
   ```bash
   python webapp/app.py
   ```
   По умолчанию откройте в браузере: `http://127.0.0.1:5000/`

4. **Проверка загрузки**:
   - Перетащите видео на жёлтую панель под плеером или выберите из списка.
   - Файл окажется в `webapp/data/video/` и сразу откроется в окне плеера.

## 3.1) Настройка переменных окружения
- Секреты и параметры LLM больше не хранятся в `config.json`. Создайте файл `.env` в корне проекта (рядом с `app.py`) и добавьте переменные:
  - `VIDEOAPP_OPENAI_API_KEY`
  - `VIDEOAPP_OPENAI_API_BASE` (по умолчанию `https://api.openai.com/v1`)
  - `VIDEOAPP_OPENAI_MODEL`
  - `VIDEOAPP_TRANSCRIPTION_MODE` (`openai` или `local`)
  - `VIDEOAPP_OPENAI_STT_MODEL`
  - `VIDEOAPP_WHISPER_MODEL`
  - `VIDEOAPP_WHISPER_LANGUAGE`
  - `VIDEOAPP_CORS_ORIGINS` — список источников через запятую (например `http://localhost:8080,http://127.0.0.1:8080`)
  - `VIDEOAPP_DISABLE_CORS` — установите в `true`, `1` или `yes`, чтобы полностью отключить Flask-CORS (по умолчанию CORS включён)
- Любая настройка из списка `VIDEOAPP_*` берётся сначала из переменных окружения / `.env`, затем из `config.json`, и только потом проваливается к значениям по умолчанию в коде.

### Заметки
- Поддерживаются стандартные контейнеры браузерного `<video>` (mp4/webm и т.д. — зависит от кодеков браузера).
- Папку `webapp/data/video/` при первом запуске создавать не требуется — она уже есть.
- Для развёртывания на сервере позже можно вынести статическую отдачу видео за Nginx/Lighttpd и оставить Flask для API/шаблонов.

---

## 4) Вектор развития (коротко)
- Аннотации/таймкоды/закладки.
- Предобработка: пробег по треку, извлечение субтитров/ASR и «якорей» содержимого.
- Интеграция LLM в sidebar: вопросы по текущему тайм‑коду, автогенерация квизов, конспекты.
- Пользовательские коллекции: локальный индекс видео, сохранение состояния в `localStorage`/IndexedDB.
