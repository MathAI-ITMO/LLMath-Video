<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Видеоплеер (прототип)</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}" />
    <script>
      window.MathJax = { tex: { inlineMath: [['$', '$'], ['\\(', '\\)']] }, svg: { fontCache: 'global' } };
    </script>
    <script defer src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js"></script>
    <script>
      window.AppConfig = {
        singleMode: {{ 'true' if single_name else 'false' }},
        singleName: {{ (single_name or '')|tojson }}
      };
    </script>
  </head>
  <body{% if not single_name %} class="main-page"{% endif %}{% if embedded %} data-embedded="true"{% endif %}>
    <div class="page-container"{% if embedded %} class="embedded-mode"{% endif %}>
      <!-- Основной раздел плеера -->
      <div class="player-section" id="player-section">
        <!-- Единая панель 16:9: либо список/загрузка, либо видео -->
        <div class="panel-container">
          <div class="aspect-16x9" id="main-panel">
            <!-- Оверлей обработки видео (поверх любых слоёв) -->
            <div id="processing-overlay" class="processing-overlay" style="display: none;">
              <div class="spinner"></div>
              <div class="processing-title">Обработка видео…</div>
              <div class="processing-steps">
                <div class="step step-extract active">1) Отделение звука</div>
                <div class="step step-transcribe">2) Распознавание текста</div>
                <div class="step step-summarize">3) Саммаризация</div>
              </div>
            </div>
            <!-- Слой списка/загрузки (по умолчанию) -->
            <div id="drop-layer" class="drop-layer">
              <div id="upload-instructions" class="upload-instructions">
                Перетащите видео сюда или <span id="file-select-trigger" class="file-select-trigger">выберите файл</span>
                <input type="file" id="file-input" accept="video/*" style="display: none;" />
              </div>
              <div class="video-list-container">
                <input type="text" id="video-filter" class="video-filter" placeholder="Фильтр по названию..." />
                <ul id="video-list" class="video-list"></ul>
              </div>
            </div>
            <!-- Слой видео (скрыт до загрузки/выбора) -->
            <div id="video-layer" class="video-layer" style="display: none;">
              {% if not single_name %}
              <button id="close-video" class="close-button" title="Закрыть">×</button>
              {% endif %}
              <video id="video-player" preload="metadata"></video>
              <!-- Тултип для пояснения кадра -->
              <div id="explain-tooltip" class="explain-tooltip">
                <span>Анализ кадра</span>
                <button id="explain-btn" class="explain-btn">Поясни</button>
              </div>
            </div>
          </div>
        </div>

        <!-- Панель управления (скрыта до загрузки видео) -->
        <div id="controls" class="controls" style="display: none;">
          <button id="play-pause" class="control-button">Воспроизвести</button>
          <input type="range" id="progress" class="progress-bar" value="0" min="0" max="0" step="0.1" />
          <span id="time-display" class="time-display">0:00 / 0:00</span>
          <label class="control-label">
            Громкость
            <input type="range" id="volume" class="volume-slider" min="0" max="1" step="0.01" value="1" />
          </label>
          <label class="control-label">
            Скорость
            <select id="speed" class="speed-select">
              <option value="0.5">0.5×</option>
              <option value="0.75">0.75×</option>
              <option value="1" selected>1×</option>
              <option value="1.25">1.25×</option>
              <option value="1.5">1.5×</option>
              <option value="2">2×</option>
            </select>
          </label>
        </div>

        {% if subtitles_panel_enabled %}
        <div id="subtitle-panel" style="display: none;">
          <ul id="subtitle-list"></ul>
        </div>
        {% endif %}
      </div>

      <!-- Боковая панель: вкладки чата/о лекции/лог -->
      {% if single_name %}
      <div class="sidebar">
        <div class="tabs" id="tabs">
          <button class="tab-btn active" data-tab="chat" id="tab-chat">Чат</button>
          <button class="tab-btn" data-tab="about" id="tab-about">О лекции</button>
        </div>
        <div class="tab-panels" id="tab-panels">
          <div id="panel-chat" class="tab-panel" style="display:block;">
            <div class="chat-container">
              <div id="chat-messages" class="chat-messages"></div>
              <div class="chat-input-row">
                <input id="chat-input" class="chat-input" type="text" placeholder="Задайте вопрос по лекции…" />
                <button id="chat-send" class="chat-send"><span class="chat-send-text">Отправить</span></button>
              </div>
            </div>
          </div>
          <div id="panel-about" class="tab-panel" style="display:none;">
            <div id="about-content" class="about-content"></div>
          </div>
        </div>
      </div>
      {% endif %}
    </div>

    <script src="{{ url_for('static', filename='js/script.js') }}"></script>
  </body>
</html>
